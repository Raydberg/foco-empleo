---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getPubDate } from "../../core/utils/getFileDate";
import HeadTitle from "../../shared/components/HeadTitle.astro";

export async function getStaticPaths() {
    const blogPosts = await getCollection("blog");

    return blogPosts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props as { post: CollectionEntry<"blog"> };
const { Content } = await post.render();
const { title, description, image } = post.data;
const pubDate = getPubDate(post);

const imageUrl = image ? new URL(image.src, Astro.site).toString() : undefined;
---

<Layout title={title} description={description} image={imageUrl}>
    <HeadTitle title="Blog" />
    <article class="container mx-auto px-6 md:px-20 lg:px-40 py-4 md:py-16">
        <header class="mb-4 md:mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                {title}
            </h1>

            <div class="flex items-center gap-2 text-gray-600 mb-6">
                <p>Publicado en</p>
                <time datetime={pubDate.toISOString()}>
                    {
                        pubDate.toLocaleDateString("es-ES", {
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                        })
                    }
                </time>
            </div>
        </header>

        {
            image && (
                <Image
                    src={image}
                    alt={title}
                    widths={[640, 768, 1024, 1280]}
                    sizes="(max-width: 768px) 100vw, 800px"
                    class="w-full mx-auto h-[200px] md:h-[300px] object-cover rounded-2xl mb-4 md:mb-8 shadow-lg"
                    loading="eager"
                    transition:name={`${post.slug}-image`}
                />
            )
        }

        <div
            class="prose prose-base md:prose-lg max-w-none prose-headings:text-gray-900 prose-a:text-teal-700 hover:prose-a:text-teal-900 prose-strong:text-gray-900 prose-code:text-teal-800 prose-code:bg-teal-50 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-img:rounded-xl"
        >
            <Content />
        </div>

        <div class="mt-8 md:mt-12 pt-8 border-t border-gray-200">
            <a
                href="/blog"
                class="inline-flex items-center text-teal-700 hover:text-teal-900 font-medium"
            >
                <svg
                    class="w-4 h-4 mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 19l-7-7 7-7"></path>
                </svg>
                Volver al blog
            </a>
        </div>
    </article>
</Layout>
