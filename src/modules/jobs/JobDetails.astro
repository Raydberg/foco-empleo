---
import JobIcon from "../../shared/icons/JobIcon.astro";
import LocationIcon from "../../shared/icons/LocationIcon.astro";
import TimeIcon from "../../shared/icons/TimeIcon.astro";
import WalletIcon from "../../shared/icons/WalletIcon.astro";
import DefaultJobIcon from "../../shared/icons/DefaultJobIcon.astro";

import RelatedJobsCarousel from "./components/RelatedJobsCarousel.astro";
import SocialSection from "./components/SocialSection.astro";


const { job, relatedJobs } = Astro.props;
---

<article class="container mx-auto px-4 py-16 max-w-6xl relative">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
            <!-- Header (Inline implementation for static rendering) -->
            <header class="bg-white p-6 md:p-8 mb-6">
                <div class="flex items-start gap-4 mb-6">
                    {
                        job.employer_logo ? (
                            <div class="shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-lg border border-gray-100 p-2 flex items-center justify-center bg-white">
                                <img
                                    src={job.employer_logo}
                                    alt={`Logo de ${job.employer_name}`}
                                    class="w-full h-full object-contain"
                                    loading="eager"
                                />
                            </div>
                        ) : (
                            <div class="shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-lg border border-gray-100 p-2 flex items-center justify-center bg-white">
                                <DefaultJobIcon />
                            </div>
                        )
                    }

                    <div class="flex-1 min-w-0">
                        <h1
                            class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"
                        >
                            {job.job_title}
                        </h1>
                        <p class="text-lg text-gray-600 mb-3">
                            {job.employer_name}
                        </p>
                        <div class="flex flex-wrap gap-3 text-sm text-gray-600">
                            {
                                (job.job_city || job.job_state) && (
                                    <span class="flex items-center gap-2">
                                        <LocationIcon />{" "}
                                        {job.job_city
                                            ? job.job_city +
                                              (job.job_state ? ", " : "")
                                            : ""}{" "}
                                        {job.job_state || ""}
                                    </span>
                                )
                            }
                            <span class="flex items-center gap-2">
                                <TimeIcon />
                                {job.job_employment_type || "Full Time"}
                            </span>
                            {
                                job.job_posted_at && (
                                    <span class="flex items-center gap-2">
                                        {job.job_posted_at}
                                    </span>
                                )
                            }
                        </div>
                    </div>
                </div>
            </header>

            <section class="bg-white p-6 md:p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">
                    Descripci칩n del Empleo
                </h2>
                <!-- Render description safely -->
                <div
                    class="prose prose-lg max-w-none text-gray-700 whitespace-pre-line"
                    set:html={job.job_description}
                />
            </section>

            <a
                href={job.job_apply_link}
                target="_blank"
                rel="noopener noreferrer"
                class="w-full md:w-auto bg-teal-800 hover:bg-teal-900 text-white font-semibold py-3 px-8 rounded-lg transition-colors shadow-sm text-center block md:inline-block"
            >
                Aplicar Ahora
            </a>

            <p class="mt-6 text-sm text-gray-600">
                Haz clic en el bot칩n "Aplicar" y ser치s redirigido a la vacante
                de la empresa para completar tu aplicaci칩n.
            </p>

            <div class="mt-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Etiquetas:</h3>
                <div class="flex flex-wrap gap-3">
                    {
                        job.job_employment_type && (
                            <span class="px-4 py-2 bg-teal-800 text-white text-sm rounded-lg">
                                {job.job_employment_type}
                            </span>
                        )
                    }
                    {
                        job.job_city && (
                            <span class="px-4 py-2 bg-teal-800 text-white text-sm rounded-lg">
                                {job.job_city}
                            </span>
                        )
                    }
                    {
                        job.job_state && (
                            <span class="px-4 py-2 bg-teal-800 text-white text-sm rounded-lg">
                                {job.job_state}
                            </span>
                        )
                    }
                    {
                        job.job_is_remote && (
                            <span class="px-4 py-2 bg-teal-800 text-white text-sm rounded-lg">
                                Remoto
                            </span>
                        )
                    }
                    {
                        job.employer_name && (
                            <span class="px-4 py-2 bg-teal-800 text-white text-sm rounded-lg">
                                {job.employer_name}
                            </span>
                        )
                    }
                </div>
            </div>

            <!-- Social Section -->
            <SocialSection
                jobTitle={job.job_title}
                employerName={job.employer_name}
            />
        </div>

        <aside class="hidden lg:block lg:col-span-1">
            <div class="bg-white p-6 sticky top-4">
                <a
                    href={job.job_apply_link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-6 w-full bg-teal-800 hover:bg-teal-900 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-sm text-center block"
                >
                    Aplicar Ahora
                </a>
            </div>
        </aside>
    </div>

    <!-- Static Related Jobs Carousel -->
    <RelatedJobsCarousel jobs={relatedJobs} />
</article>
